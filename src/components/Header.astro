---
import headerJson from "@data/header.json";
import { Icon } from "astro-icon";
import { Picture } from "astro-imagetools/components";

const { links } = headerJson;
---

<section class="bg-esl-c-1">
  <section
    class="flex justify-center items-center container relative py-2 md:py-4 lg:py-8"
  >
    <!-- Mobile Menu Button -->
    <button
      aria-label="Toggle mobile menu"
      data-navbar-menu-btn
      class="absolute left-2 p-2 border rounded-md overflow-hidden text-white lg:hidden"
    >
      <div data-navbar-menu-icon class="bg-esl-c-1 absolute transition">
        <Icon name="charm:menu-hamburger" class="h-[1.5rem] w-[1.5rem]" />
      </div>
      <Icon name="ic:baseline-close" class="h-[1.5rem] w-[1.5rem]" />
    </button>

    <!-- Logo -->
    <a class="block w-40 invert brightness-0" href="/">
      <Picture
        breakpoints={[360]}
        objectFit="contain"
        src="/images/logo/logo-horizontal.png"
        alt="logo"
      />
    </a>

    <!-- Navigations Mobile -->
    <nav
      data-navbar-mobile-nav
      class="bg-white absolute top-full w-full grid grid-rows-[0fr] transition-all lg:hidden"
    >
      <ul class="overflow-hidden">
        {
          links.map((link) => {
            return (
              <li>
                <a
                  data-navbar-link
                  class="p-4 block w-full text-start"
                  href={link.href}
                >
                  {link.label}
                </a>
              </li>
            );
          })
        }
      </ul>
    </nav>

    <!-- Navigations Desktop -->
    <nav
      class="text-white absolute mx-auto w-fit left-0 right-0 hidden lg:block"
    >
      <ul class="flex items-center space-x-8">
        {
          links.map((link) => {
            return (
              <li>
                <a class="group" href={link.href}>
                  <span>{link.label}</span>
                  <div class="h-0.5 scale-x-0 bg-white origin-left transition group-hover:scale-x-100" />
                </a>
              </li>
            );
          })
        }
      </ul>
    </nav>

    <!-- CTA: Contact us -->
    <a
      href="#contact"
      class="px-6 py-2 hidden ml-auto transition bg-white rounded-full lg:block hover:text-white hover:bg-esl-c-2"
    >
      联系我们
    </a>
  </section>
</section>

<script>
  const links =
    document.querySelectorAll<HTMLButtonElement>("[data-navbar-link]");
  const menuIcon = document.querySelector("[data-navbar-menu-icon]");
  const menuBtn = document.querySelector("[data-navbar-menu-btn]");
  const mobileNav = document.querySelector("[data-navbar-mobile-nav]");

  if (links && menuIcon && menuBtn && mobileNav) {
    let open = false;

    const handleOpen = () => {
      if (open) {
        menuIcon.classList.remove("translate-y-[150%]");
        mobileNav.classList.add("grid-rows-[0fr]");
        mobileNav.classList.remove("grid-rows-[1fr]");
        open = false;
      } else {
        menuIcon.classList.add("translate-y-[150%]");
        mobileNav.classList.remove("grid-rows-[0fr]");
        mobileNav.classList.add("grid-rows-[1fr]");
        open = true;
      }
    };

    menuBtn.addEventListener("click", () => {
      handleOpen();
    });

    menuBtn.addEventListener("blur", () => {
      if (!mobileNav?.matches(":hover") && open) {
        handleOpen();
      }
    });

    links.forEach((link) => {
      link.addEventListener("click", () => {
        handleOpen();
      });
    });
  } else if (!links) {
    alert("Navbar: links not found");
  } else if (!menuIcon) {
    alert("Navbar: menuIcon not found");
  } else if (!menuBtn) {
    alert("Navbar: menuBtn not found");
  } else if (!mobileNav) {
    alert("Navbar: mobileNav not found");
  }
</script>
