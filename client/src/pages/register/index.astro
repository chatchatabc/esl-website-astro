---
import MainLayout from "@layouts/MainLayout.astro";
---

<MainLayout>
  <section class="max-w-xl mx-auto p-8">
    <section class="bg-white rounded-xl overflow-hidden p-8">
      <header>
        <h1 class="text-2xl">Sign Up</h1>
      </header>

      <section class="mt-4">
        <form data-register-form class="-mx-1">
          <label class="flex flex-col p-1">
            <span class="text-xs font-bold">Username</span>
            <input
              required
              name="username"
              class="border rounded-md p-2"
              placeholder="Username"
            />
          </label>
          <label class="flex flex-col p-1">
            <span class="text-xs font-bold">Password</span>
            <input
              required
              name="password"
              type="password"
              class="border rounded-md p-2"
              placeholder="Password"
            />
          </label>
          <label class="flex flex-col p-1">
            <span class="text-xs font-bold">Confirm Password</span>
            <input
              required
              name="confirmPassword"
              type="password"
              class="border rounded-md p-2"
              placeholder="Confirm Password"
            />
          </label>

          <footer class="p-1 mt-2 space-y-2">
            <button
              class="mx-auto text-sm w-full block p-2 rounded-md bg-blue-300 transition hover:bg-blue-400"
            >
              Sign Up
            </button>

            <section class="pt-2 text-xs flex justify-between">
              <div class="flex flex-wrap w-1/2">
                <p class="mr-1">Already a member?</p>
                <a class="text-blue-800 hover:underline" href="/login">
                  Sign in here!
                </a>
              </div>

              <div class="flex justify-end flex-wrap w-1/2">
                <p class="mr-1">Need help?</p>
                <a class="text-blue-800 hover:underline">Contact us!</a>
              </div>
            </section>
          </footer>
        </form>
      </section>
    </section>
  </section>
</MainLayout>

<script>
  import { authRegister } from "src/services/authService";
  import type { UserRegister } from "../../../../server/src/domain/models/UserModel";

  const form = document.querySelector<HTMLFormElement>("[data-register-form]")!;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data: UserRegister = Object.fromEntries(formData.entries()) as any;
  
    if (data.password !== data.confirmPassword) {
      alert("Passwords do not match");
      return;
    }
    data.role = 1;

    const response = await authRegister(data);

    if (response.errors) {
      alert(response.errors[0].message);
    } else {
      // alert("Account created successfully")
      window.location.href = "/register/more-details";
    }
  });
</script>
